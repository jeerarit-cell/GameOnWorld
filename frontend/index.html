<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>WORLD CHASER - Verify & Play</title>
    
    <style>
        :root { 
            --neon: #ff9500; 
            --neon-hot: #00e5ff;
            --bg: #2d2d2d; 
            --card: rgba(255, 255, 255, 0.5); 
            --border: rgba(255, 255, 255, 0.5); 
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        html, body { 
            width: 100%; height: 100%; margin: 0; padding: 0; 
            background-color: #050b18; 
            background-image: url('https://github.com/user-attachments/assets/2919ee1f-6eb5-4139-ae6c-72aeaa83c89f'); 
            background-size: cover; 
            background-position: center; 
            background-repeat: no-repeat;
            background-attachment: fixed;
            color: white; 
            font-family: -apple-system, sans-serif; 
            overflow: hidden; 
            position: fixed;
        }

        .screen { 
            display: none; height: 100vh; flex-direction: column; width: 100%; max-width: 500px; 
            margin: 0 auto;
            background: rgba(10, 15, 28, 0.6); 
            backdrop-filter: blur(20px) brightness(80%) saturate(140%);
            -webkit-backdrop-filter: blur(20px) brightness(80%) saturate(140%);
            position: relative; 
            border-left: 1px solid rgba(255,255,255,0.1); 
            border-right: 1px solid rgba(255,255,255,0.1);
        }
            
        .news-ticker { background: rgba(0,0,0,0.8); color: var(--neon); padding: 7px 0; font-size: 0.75rem; border-bottom: 1px solid var(--neon); white-space: nowrap; overflow: hidden; flex-shrink: 0; }
        .ticker-text { display: inline-block; animation: ticker 25s linear infinite; padding-left: 100%; }
        @keyframes ticker { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }
        .active { display: flex; }

        .room-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%; margin: 15px 0; }
        .room-btn { background: rgba(0, 255, 209, 0.1); border: 1px solid var(--border); border-radius: 12px; padding: 12px; color: #ccc; cursor: pointer; text-align: center; transition: 0.2s; }
        .room-btn b { display: block; font-size: 1.2rem; }
        .room-btn span { font-size: 0.6rem; letter-spacing: 1px; }
        .room-btn.selected { border-color: var(--neon); background: rgba(0, 255, 209, 0.2); color: var(--neon); box-shadow: 0 0 15px rgba(0, 255, 209, 0.4); border: 1px solid var(--neon); }

        .top-nav { display: flex; justify-content: space-between; padding: 10px 15px; background: rgba(0,0,0,0.4); align-items: center; border-bottom: 1px solid var(--border); flex-shrink: 0; }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 10px 15px; flex-shrink: 0; }
        .stat-card { background: rgba(50, 70, 209, 0.3); border: 1px solid var(--border); padding: 8px; border-radius: 10px; text-align: center; font-size: 0.65rem; color:white; }
        .stat-card b { color: var(--neon); font-size: 0.85rem; display: block; margin-top: 2px; }

        .board-container { padding: 0 15px 10px 15px; display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px; flex-shrink: 0; perspective: 500px; }
        .slot { 
            aspect-ratio: 1/1; background: rgba(100,200,220,0.1); border: 1px solid rgba(200,150,50,0.5); 
            border-radius: 6px; display: flex; align-items: center; justify-content: center; 
            font-size: 0.6rem; color: #777; transition: all 0.2s ease; overflow: hidden;
            text-align: center; word-break: break-all; position: relative; padding: 2px;
        }
        .slot.active-chaser { 
            border-color: #fff; background: var(--neon); color: #000 !important; 
            font-weight: bold; transform: scale(1.1); box-shadow: 0 0 20px var(--neon); z-index: 10;
        }
        @keyframes winnerFlash { from { background: var(--neon); } to { background: #fff; transform: scale(1.15); } }
        .slot.winner-slot { animation: winnerFlash 0.2s infinite alternate; z-index: 20; color: #000 !important; }

        .main-content { display: flex; padding: 0 15px 10px 15px; gap: 10px; align-items: flex-start; }
        .left-panel { flex: 1.6; display: flex; flex-direction: column; gap: 6px; }
        .status-row { display: flex; gap: 6px; }
        .status-pill { flex: 1; background: rgba(5, 55, 209, 0.3); border: 1px solid var(--border); border-radius: 8px; padding: 5px; text-align: center; font-size: 0.7rem; color: #ccc; }
        
        .chat-section { height: 300px; border: 1px solid var(--border); border-radius: 12px; background: rgba(0,0,0,0.5); display: flex; flex-direction: column; overflow: hidden; }
        #chatBox { flex: 1; padding: 10px; overflow-y: auto; font-size: 0.8rem; scroll-behavior: smooth; }
        .chat-input-row { padding: 8px 12px; background: rgba(0,0,0,0.6); border-top: 1px solid var(--border); }
        .chat-input-row input { width: 100%; background: transparent; border: none; color: var(--neon); font-size: 13px; }

        .menu-section { flex: 1; display: flex; flex-direction: column; gap: 8px; height: 340px; }
        .btn-play-action { flex: 2; background: linear-gradient(145deg, var(--neon), var(--neon-hot)); border: none; color: #000; border-radius: 15px; font-size: 1.2rem; font-weight: 900; cursor: pointer; transition: 0.2s; }
        .btn-play-action:active { transform: scale(0.95); }
        .btn-menu-sub { flex: 0.7; background: rgba(5, 55, 209, 0.3); border: 1px solid var(--border); color: #ccc; border-radius: 10px; font-size: 0.7rem; font-weight: bold; cursor: pointer; }
        
        .overlay-panel { display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: #1a1a1a; z-index: 500; padding: 20px; flex-direction: column; }
    </style>
</head>
<body>

    <div class="news-ticker">
        <div class="ticker-text" id="tickerText">‚ú® WELCOME TO WORLD CHASER: ‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏û‡∏•‡∏±‡∏á‡πÅ‡∏´‡πà‡∏á‡∏™‡∏≤‡∏¢‡∏•‡∏°‡πÅ‡∏•‡∏∞‡∏•‡πà‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• WLD ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!</div>
    </div>

    <div id="lobby" class="screen active">
        <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:30px;">
            <h1 style="color:#fff; font-size: 2.4rem; margin: 0; letter-spacing: 4px;">WORLD</h1>
            <h1 style="color:var(--neon); font-size: 2.4rem; margin: -10px 0 20px 0; text-shadow: 0 0 20px rgba(0,255,209,0.5);">CHASER</h1>
            <input type="text" id="userNameInp" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô..." maxlength="12" style="width:100%; padding:15px; border-radius:12px; border:1px solid var(--border); background:rgba(255,255,255,0.05); color:white; margin-bottom:10px; text-align:center;">
            
            <div class="room-grid">
                <div class="room-btn selected" onclick="window.selectRoom(0.001, this)"><b>0.001</b><span>WLD</span></div>
                <div class="room-btn" onclick="window.selectRoom(0.01, this)"><b>0.01</b><span>WLD</span></div>
                <div class="room-btn" onclick="window.selectRoom(0.1, this)"><b>0.1</b><span>WLD</span></div>
                <div class="room-btn" onclick="window.selectRoom(1.0, this)"><b>1.0</b><span>WLD</span></div>
            </div>

            <button onclick="window.joinGame()" style="width:100%; padding:18px; background:var(--neon); border:none; border-radius:15px; font-weight:900; color:#000; box-shadow: 0 5px 15px rgba(0,255,209,0.3); cursor: pointer;">JOIN & VERIFY</button>
            <p id="statusMsg" style="font-size:0.7rem; color:#888; margin-top:10px;">Connect World App to Play</p>
        </div>
    </div>

    <div id="game" class="screen">
        <div id="historyPanel" class="overlay-panel">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <b style="color:var(--neon)">HISTORY</b>
                <button onclick="window.closeOverlay('historyPanel')" style="background:var(--card); color:white; padding:8px 15px; border-radius:8px;">‡∏õ‡∏¥‡∏î</button>
            </div>
            <div id="historyContent" style="flex:1; overflow-y:auto;"></div>
        </div>

        <div id="leaderboardPanel" class="overlay-panel">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <b style="color:var(--neon)">LEADERBOARD</b>
                <button onclick="window.closeOverlay('leaderboardPanel')" style="background:var(--card); color:white; padding:8px 15px; border-radius:8px;">‡∏õ‡∏¥‡∏î</button>
            </div>
            <div id="leaderboardContent" style="flex:1; overflow-y:auto;"></div>
        </div>

        <div id="earnPanel" class="overlay-panel" style="justify-content:center; align-items:center; text-align:center;">
            <h1 style="color:var(--neon)">EARN</h1>
            <p style="color:#555">Coming Soon</p>
            <button onclick="window.closeOverlay('earnPanel')" style="background:var(--card); color:white; padding:12px 40px; border-radius:10px;">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        </div>

        <div class="top-nav">
            <button onclick="location.reload()" style="background:none; border:1px solid var(--border); color:white; padding:4px 10px;">‚Üê</button>
            <b id="headerPlayerName">PLAYER</b>
            <div id="roomTag" style="color:var(--neon); font-weight:bold;">WLD 0.001</div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (WLD)<br><b id="prizeDisplay">0.0000</b></div>
            <div class="stat-card">‡πÄ‡∏ß‡∏•‡∏≤<br><b id="timer">WAIT</b></div>
            <div class="stat-card">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô<br><b id="pCountTop">0/12</b></div>
        </div>

        <div class="board-container" id="board"></div>

        <div class="main-content">
            <div class="left-panel">
                <div class="status-row">
                    <div class="status-pill">ROUND <b id="roundNum" style="color:var(--neon)">#125</b></div>
                    <div class="status-pill">ONLINE <b id="onlineCount" style="color:var(--neon)">17</b></div>
                </div>
                <div class="chat-section">
                    <div id="chatBox"></div>
                    <div class="chat-input-row">
                        <input type="text" id="chatInp" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." onkeydown="if(event.key==='Enter') window.sendMsg()">
                    </div>
                </div>
            </div>
            <div class="menu-section">
                <button class="btn-play-action" id="btnPlay" onclick="window.play()">PLAY & PAY</button>
                <button class="btn-menu-sub" onclick="window.openOverlay('historyPanel')">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
                <button class="btn-menu-sub" onclick="window.openOverlay('leaderboardPanel')">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</button>
                <button class="btn-menu-sub" onclick="window.openOverlay('earnPanel')" style="color:var(--neon)">EARN</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { MiniKit } from 'https://cdn.jsdelivr.net/npm/@worldcoin/minikit-js@latest/+esm';

        // --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Wallet ---
        const MY_WALLET_ADDRESS = "0xYOUR_WALLET_ADDRESS_HERE"; // ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÉ‡∏™‡πà Wallet Address ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

        let currentPlayerName = "GUEST";
        let players = [];
        let hasJoined = false;
        let timerStarted = false;
        let round = 125;
        let gameHistory = [];
        let leaderData = {};
        let ENTRY_FEE = 0.001;
        let audioCtx;
        const HOUSE_FEE = 0.15;
        const MAX_PLAYERS = 12;

        // --- Init ---
        function initMiniKit() {
            if (MiniKit.isInstalled()) {
                console.log("World App Detected");
                document.getElementById('statusMsg').textContent = "‚úÖ Connected to World App";
                document.getElementById('statusMsg').style.color = "#00ff00";
            } else {
                console.log("Desktop / Not Installed");
                document.getElementById('statusMsg').textContent = "‚ö†Ô∏è Desktop Simulation Mode";
            }
        }
        initMiniKit();

        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playSfx(f, type, d, v) {
            try {
                initAudio();
                const o = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                o.type = type; o.frequency.setValueAtTime(f, audioCtx.currentTime);
                g.gain.setValueAtTime(v, audioCtx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
                o.connect(g); g.connect(audioCtx.destination);
                o.start(); o.stop(audioCtx.currentTime + d);
            } catch(e) {}
        }

        window.selectRoom = function(fee, btn) {
            initAudio();
            ENTRY_FEE = fee;
            document.querySelectorAll('.room-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            playSfx(600, 'sine', 0.1, 0.1);
        }

        window.openOverlay = function(id) {
            initAudio();
            document.getElementById(id).style.display = 'flex';
            if(id === 'leaderboardPanel') renderLeaderboard();
            if(id === 'historyPanel') renderHistory();
        }
        
        window.closeOverlay = function(id) { 
            document.getElementById(id).style.display = 'none'; 
        }

        // --- 1. JOIN ROOM & VERIFY (‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô) ---
        window.joinGame = async function() {
            initAudio();
            const nameInp = document.getElementById('userNameInp').value.trim();
            currentPlayerName = nameInp || "USER_" + Math.floor(Math.random()*999);

            // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô (Verify)
            if (MiniKit.isInstalled()) {
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á Verify (‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Action ‡πÉ‡∏ô Developer Portal ‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á)
                // ‡∏ä‡∏∑‡πà‡∏≠ action 'enter-lobby' ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                try {
                    const res = await MiniKit.commands.verify({
                        action: "enter-lobby", 
                        signal: currentPlayerName, 
                        verification_level: "orb" // ‡∏´‡∏£‡∏∑‡∏≠ "device"
                    });
                    
                    if (res.finalPayload.status !== 'success') {
                         alert("Verification Failed");
                         return;
                    }
                } catch (e) {
                    console.warn("Verify logic skipped/error (Check Action ID)");
                    // ‡πÉ‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á dev ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ setup action
                }
            } else {
                alert("Simulation: World ID Verified ‚úÖ");
            }

            // 2. ‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤ Lobby
            enterGameLobby();
        }

        function enterGameLobby() {
            document.getElementById('headerPlayerName').textContent = currentPlayerName.toUpperCase();
            document.getElementById('roomTag').textContent = "WLD " + ENTRY_FEE;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏∏‡πà‡∏° Play ‡πÉ‡∏´‡πâ‡∏ö‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤
            document.getElementById('btnPlay').innerHTML = `PLAY<br><span style="font-size:0.65rem; font-weight:normal;">PAY ${ENTRY_FEE} WLD</span>`;
            
            document.getElementById('lobby').classList.remove('active');
            document.getElementById('game').classList.add('active');
            updateBoard();
            playSfx(800, 'sine', 0.2, 0.1);
        }

        // --- 2. PLAY & PAY (‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô) ---
        window.play = async function() {
            initAudio(); 
            if(hasJoined) return;

            const btn = document.getElementById('btnPlay');
            
            // 1. ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô (Pay)
            if (MiniKit.isInstalled()) {
                const isPaid = await handlePayment(ENTRY_FEE);
                if (!isPaid) {
                    alert("Payment Cancelled");
                    return; // ‡∏ñ‡πâ‡∏≤‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πà‡∏ô
                }
            } else {
                 // Debug Mode
                 const confirmPay = confirm(`Simulate Payment of ${ENTRY_FEE} WLD?`);
                 if(!confirmPay) return;
            }

            // 2. ‡∏ñ‡πâ‡∏≤‡∏à‡πà‡∏≤‡∏¢‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ
            hasJoined = true;
            players.push(currentPlayerName); 
            updateBoard();
            
            btn.disabled = true; btn.style.opacity = "0.5";
            playSfx(400, 'sine', 0.1, 0.1);
            
            // Bot Logic
            let botCount = 0;
            const maxBots = Math.floor(Math.random() * 5) + 3; 
            let itv = setInterval(() => {
                if(players.length < MAX_PLAYERS && botCount < maxBots) {
                    const botNames = ["Richie", "Lucky777", "CryptoKing", "MoonBoy", "WLD_Hunter", "Satoshi", "Whale"];
                    const randomBot = botNames[Math.floor(Math.random()*botNames.length)] + "_" + Math.floor(Math.random()*99);
                    players.push(randomBot);
                    botCount++;
                    updateBoard();
                    playSfx(1000, 'sine', 0.03, 0.01); 
                    if(players.length >= 2 && !timerStarted) startCountdown();
                } else {
                    clearInterval(itv);
                }
            }, Math.random() * 1000 + 400);
        }

        async function handlePayment(amount) {
            try {
                const res = await MiniKit.commands.pay({
                    reference: "WCHASER_" + Date.now(),
                    to: MY_WALLET_ADDRESS,
                    tokens: [{
                        symbol: "WLD",
                        token_amount: amount.toString()
                    }],
                    description: `Play Round (${amount} WLD)`
                });
                
                if (res && res.finalPayload && res.finalPayload.status === 'success') {
                    return true;
                }
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Minikit Version ‡πÄ‡∏Å‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠ Mock ‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡∏≠‡∏≤‡∏à‡∏à‡∏∞ return true
                return true; 
            } catch (e) {
                console.error("Payment Error:", e);
                return false;
            }
        }

        function shortenName(name) {
            return name.length > 7 ? name.substring(0, 6) + ".." : name;
        }

        function updateBoard() {
            const b = document.getElementById('board'); b.innerHTML = "";
            for(let i=0; i < MAX_PLAYERS; i++){
                const s = document.createElement('div'); s.className = 'slot';
                if(players[i]) {
                    s.textContent = shortenName(players[i].toUpperCase());
                    s.style.color = "rgba(0, 255, 209, 1)"; s.style.borderColor = "rgba(0, 255, 209, 1)"; 
                }
                b.appendChild(s);
            }
            const prize = (players.length >= 2) ? ((players.length * ENTRY_FEE) * (1-HOUSE_FEE)).toFixed(4) : "0.0000";
            document.getElementById('prizeDisplay').textContent = prize;
            document.getElementById('pCountTop').textContent = `${players.length}/12`;
        }

        function startCountdown() {
            timerStarted = true; let sec = 10;
            const cItv = setInterval(() => {
                sec--; document.getElementById('timer').textContent = sec + "s";
                if(sec <= 3 && sec > 0) playSfx(600, 'sine', 0.1, 0.05);
                if(sec <= 0) { clearInterval(cItv); document.getElementById('timer').textContent = "LIVE"; runGame(); }
            }, 1000);
        }

        function runGame() {
            const slots = document.querySelectorAll('.slot');
            let cur = 0, speed = 50, steps = 0;
            const winIdx = Math.floor(Math.random() * players.length);
            const totalSteps = (MAX_PLAYERS * 4) + winIdx; 
            function move() {
                slots.forEach(s => s.classList.remove('active-chaser'));
                cur = (cur + 1) % MAX_PLAYERS;
                slots[cur].classList.add('active-chaser');
                playSfx(300 + (steps * 4), 'triangle', 0.05, 0.03);
                steps++;
                if(steps < totalSteps) {
                    if(totalSteps - steps < 15) speed += 25;
                    if(totalSteps - steps < 5) speed += 60;
                    setTimeout(move, speed);
                } else {
                    finish(cur);
                }
            }
            move();
        }

        function finish(idx) {
            const slots = document.querySelectorAll('.slot');
            const winner = players[idx];
            const amount = parseFloat(document.getElementById('prizeDisplay').textContent);
            slots[idx].classList.add('winner-slot');
            gameHistory.unshift({ round: round, winner: winner, amount: amount.toFixed(4) });
            leaderData[winner] = (leaderData[winner] || 0) + amount;
            playSfx(880, 'sine', 0.5, 0.1); 
            document.getElementById('tickerText').textContent = `üéä ROUND #${round} WINNER: ${winner} WON ${amount.toFixed(4)} WLD!`;
            addChat("üèÜ SYSTEM", `${winner} ‡∏ä‡∏ô‡∏∞‡∏£‡∏±‡∏ö ${amount.toFixed(4)} WLD`, "color:#000; background:var(--neon); font-weight:bold; padding:0 4px; border-radius:4px;");
            setTimeout(reset, 5000);
        }

        function renderHistory() {
            const h = document.getElementById('historyContent');
            h.innerHTML = gameHistory.map(i => `<div style="padding:12px; border-bottom:1px solid #1a1a1e;">‡∏£‡∏≠‡∏ö #${i.round} | <b>${i.winner}</b> <span style="color:var(--neon); float:right;">${i.amount} WLD</span></div>`).join('') || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥";
        }

        function renderLeaderboard() {
            const l = document.getElementById('leaderboardContent');
            const sorted = Object.entries(leaderData).sort((a,b) => b[1] - a[1]).slice(0, 50);
            l.innerHTML = sorted.map((i, idx) => `<div style="padding:12px; border-bottom:1px solid #1a1a1e;">${idx+1}. <b>${i[0]}</b> <span style="color:var(--neon); float:right;">${i[1].toFixed(4)} WLD</span></div>`).join('') || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        }

        function reset() {
            round++; document.getElementById('roundNum').textContent = "#" + round;
            players = []; hasJoined = false; timerStarted = false;
            document.getElementById('timer').textContent = "WAIT"; updateBoard();
            const btn = document.getElementById('btnPlay');
            btn.disabled = false; btn.style.opacity = "1";
        }

        function addChat(u, m, s='') {
            const b = document.getElementById('chatBox');
            b.innerHTML += `<div style="margin-bottom:6px; font-size:0.75rem;"><b style="${s}">${u}:</b> <span style="color:#ddd">${m}</span></div>`;
            b.scrollTop = b.scrollHeight;
        }

        window.sendMsg = function() {
            initAudio();
            const i = document.getElementById('chatInp');
            if(i.value.trim()) { addChat(currentPlayerName, i.value, "color:var(--neon)"); i.value = ""; }
        }
    </script>
</body>
</html>
