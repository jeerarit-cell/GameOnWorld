<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CYBER CARD BATTLE</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;600&family=Orbitron:wght@700&display=swap');

        :root {
            --main-green: #00ff41;
            --main-red: #ff3333;
            --bg-color: #0d0d0d;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; outline: none; }
        
        body {
            margin: 0; padding: 0;
            background-color: #000;
            font-family: 'Kanit', sans-serif;
            width: 100vw; height: 100vh;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }

        .app-container {
            width: 100%; height: 100%; max-width: 480px;
            background-color: var(--bg-color);
            background-image: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), url('https://images.unsplash.com/photo-1535868463750-c78d9543614f?q=80&w=2076');
            background-size: cover; background-position: center;
            display: flex; flex-direction: column;
            position: relative;
        }

        /* HEADER */
        .header {
            height: 60px; flex-shrink: 0;
            background: rgba(20, 20, 20, 0.9);
            border-bottom: 2px solid #333;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px;
        }
        .user-profile { font-family: 'Orbitron'; color: white; font-size: 1.1rem; }
        .user-balance { color: var(--main-green); font-size: 0.9rem; }

        /* BATTLE AREA */
        .battle-area {
            flex: 1; display: flex; flex-direction: column; 
            justify-content: space-between;
            padding: 10px; overflow: hidden;
        }

        /* Boss Zone */
        .boss-zone { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .boss-img-frame {
            width: 80px; height: 80px; 
            border: 2px solid var(--main-red); border-radius: 10px;
            overflow: hidden; background: #000;
        }
        .boss-img-frame img { width: 100%; height: 100%; object-fit: cover; }
        
        /* HP Bars */
        .hp-bar-box { width: 180px; height: 14px; background: #333; border-radius: 7px; overflow: hidden; position: relative; margin-top: 2px; transition: 0.2s; }
        .hp-fill { height: 100%; width: 100%; transition: width 0.5s cubic-bezier(0.4, 0.0, 0.2, 1); }
        .hp-enemy { background: var(--main-red); }
        .hp-player { background: var(--main-green); }
        .hp-text { position: absolute; width: 100%; text-align: center; font-size: 10px; line-height: 14px; color: white; font-weight: bold; top:0; }
        
        /* Damage Floating Text */
        .dmg-float {
            position: absolute; color: white; font-weight: bold; font-size: 1.5rem;
            text-shadow: 0 0 5px red; top: -20px; left: 50%; transform: translateX(-50%);
            opacity: 0; transition: 0.5s; pointer-events: none;
        }
        .dmg-float.show { top: -40px; opacity: 1; }

        /* Card Rows */
        .card-row { display: flex; gap: 5px; justify-content: center; height: 60px; width: 100%; margin-top: 5px; }
        .card {
            width: 45px; height: 65px; 
            border: 1px solid #555; border-radius: 4px;
            background: rgba(0,0,0,0.6);
            display: flex; align-items: center; justify-content: center;
            font-family: 'Orbitron'; font-size: 1.2rem; color: white; transition: 0.3s;
        }
        .card.enemy { background: #222; border-color: var(--main-red); color: transparent; }
        .card.enemy.revealed { background: var(--main-red); color: white; border-color: white; }
        /* ‡πÑ‡∏û‡πà‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏î‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï (Safe) */
        .card.safe { border-color: yellow; box-shadow: 0 0 10px yellow; transform: scale(1.1); z-index: 2; color: yellow; background: black; }

        /* Clash Zone */
        .clash-zone {
            display: flex; gap: 5px; justify-content: center; align-items: center;
            height: 80px; border-top: 1px dashed #444; border-bottom: 1px dashed #444; position: relative;
        }
        .clash-slot {
            width: 45px; height: 65px; border: 1px dashed #555; border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
        }
        .clash-slot.active { border: 1px solid var(--main-green); background: rgba(0, 255, 65, 0.1); }
        .clash-slot div {
            width: 100%; height: 100%; background: var(--main-green); color: black;
            display: flex; align-items: center; justify-content: center;
            font-family: 'Orbitron'; font-size: 1.2rem; font-weight: bold;
        }

        /* Player Zone */
        .player-zone { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .my-card { cursor: pointer; border: 1px solid var(--main-green); color: var(--main-green); }
        .my-card.selected { transform: translateY(-10px); background: var(--main-green); color: black; }
        .my-card.used { opacity: 0; pointer-events: none; }

        /* X Mark */
        .x-mark {
            position: absolute; font-size: 2.5rem; color: #555; font-weight: 900;
            text-shadow: 0 0 2px black; z-index: 10;
        }
        .card-dead { filter: brightness(0.3); }

        /* CONTROLS */
        .controls {
            height: 70px; flex-shrink: 0;
            background: rgba(0,0,0,0.9); border-top: 1px solid #333;
            display: flex; justify-content: center; align-items: center; padding: 0 20px;
        }
        .main-btn {
            width: 100%; max-width: 300px; height: 45px;
            background: var(--main-green); border: none; border-radius: 25px;
            font-family: 'Orbitron'; font-size: 1.2rem; color: black; font-weight: bold;
            cursor: pointer;
        }
        .main-btn:disabled { background: #333; color: #555; }
        .main-btn.attack { background: var(--main-red); color: white; }

        /* NAV */
        .nav-bar {
            height: 60px; flex-shrink: 0;
            background: #000; border-top: 1px solid #222;
            display: flex; justify-content: space-around; align-items: center;
        }
        .nav-icon { font-size: 1.5rem; opacity: 0.5; }
        .nav-icon.active { opacity: 1; color: var(--main-green); }

        /* MODAL */
        .modal {
            position: absolute; inset: 0; background: rgba(0,0,0,0.95);
            display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 99;
        }
        .modal h1 { font-family: 'Orbitron'; font-size: 3rem; margin: 0; text-align: center;}
        .modal p { color: #aaa; margin-top: 5px; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <div class="user-profile">PLAYER_1</div>
        <div class="user-balance">125.00 WLD</div>
    </div>

    <div class="battle-area">
        
        <div class="boss-zone">
            <div class="boss-img-frame">
                <img src="https://i.pinimg.com/736x/87/40/2c/87402c5950cb630a91e4f4460f997235.jpg" alt="Boss">
            </div>
            <div class="hp-bar-box" id="eHpBox">
                <div class="hp-fill hp-enemy" id="enemyHpBar"></div>
                <div class="hp-text" id="enemyHpText">20/20</div>
                <div class="dmg-float" id="eDmgText">-0</div>
            </div>
            <div class="card-row" id="enemyCardRow"></div>
        </div>

        <div class="clash-zone" id="clashZone">
            </div>

        <div class="player-zone">
            <div class="hp-bar-box" id="pHpBox" style="border-color: #00ff41;">
                <div class="hp-fill hp-player" id="playerHpBar"></div>
                <div class="hp-text" id="playerHpText">20/20</div>
                <div class="dmg-float" id="pDmgText">-0</div>
            </div>
            <div class="card-row" id="playerCardRow"></div>
        </div>
    </div>

    <div class="controls">
        <button id="actionBtn" class="main-btn" onclick="initGame()">START GAME</button>
    </div>

    <div class="nav-bar">
        <div class="nav-icon active">üè†</div>
        <div class="nav-icon">‚öîÔ∏è</div>
        <div class="nav-icon">üéí</div>
    </div>

    <div id="resultModal" class="modal">
        <h1 id="resultTitle">WIN</h1>
        <p id="resultSub">CLICK TO RESTART</p>
        <button class="main-btn" style="width:200px; margin-top:20px;" onclick="initGame()">PLAY AGAIN</button>
    </div>
</div>

<script>
    const MAX_HP = 20;
    let pHP = MAX_HP, eHP = MAX_HP;
    let pDeck = [], eDeck = [];
    let placedCards = [null, null, null, null, null];
    let currentTurn = 0;
    let isPlaying = false;

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function beep(freq=440, type='sine') {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = type; o.frequency.value = freq;
        g.gain.setValueAtTime(0.05, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
        o.connect(g); g.connect(audioCtx.destination);
        o.start(); o.stop(audioCtx.currentTime + 0.1);
    }

    function getShuffledDeck() {
        return [1, 2, 3, 4, 5].sort(() => Math.random() - 0.5);
    }

    function initGame() {
        pHP = MAX_HP; eHP = MAX_HP;
        currentTurn = 0;
        placedCards = [null, null, null, null, null];
        isPlaying = false;
        
        // Reset Visuals
        document.getElementById('resultModal').style.display = 'none';
        updateUI();
        
        // Setup Slots
        const cZone = document.getElementById('clashZone');
        cZone.innerHTML = '';
        for(let i=0; i<5; i++) {
            const slot = document.createElement('div');
            slot.className = i===0 ? 'clash-slot active' : 'clash-slot';
            slot.dataset.id = i;
            cZone.appendChild(slot);
        }

        // Setup Enemy Row
        const eRow = document.getElementById('enemyCardRow');
        eRow.innerHTML = '';
        for(let i=0; i<5; i++) {
            eRow.innerHTML += `<div class="card enemy" id="eCard${i}">?</div>`;
        }

        // Setup Player Row
        pDeck = getShuffledDeck();
        eDeck = getShuffledDeck();
        const pRow = document.getElementById('playerCardRow');
        pRow.innerHTML = '';
        pDeck.forEach((val) => {
            const card = document.createElement('div');
            card.className = 'card my-card';
            card.textContent = val;
            card.onclick = () => playCard(val, card);
            pRow.appendChild(card);
        });

        // Btn
        const btn = document.getElementById('actionBtn');
        btn.textContent = "SELECT CARDS";
        btn.disabled = true;
        btn.classList.remove('attack');
        
        beep(600, 'square');
    }

    function playCard(val, el) {
        if(isPlaying || currentTurn >= 5 || el.classList.contains('used')) return;

        placedCards[currentTurn] = val;
        
        const slot = document.querySelector(`.clash-slot[data-id="${currentTurn}"]`);
        slot.innerHTML = `<div>${val}</div>`;
        slot.classList.remove('active');
        
        el.classList.add('used');
        beep(400 + (val*50), 'sine');

        currentTurn++;
        if(currentTurn < 5) {
            document.querySelector(`.clash-slot[data-id="${currentTurn}"]`).classList.add('active');
        } else {
            const btn = document.getElementById('actionBtn');
            btn.textContent = "ATTACK !!!";
            btn.disabled = false;
            btn.classList.add('attack');
            btn.onclick = startBattle;
        }
    }

    async function startBattle() {
        isPlaying = true;
        document.getElementById('actionBtn').disabled = true;

        let pSurvivors = []; 
        let eSurvivors = []; 

        // Loop ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏û‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏ú‡∏•‡πÅ‡∏û‡πâ‡∏ä‡∏ô‡∏∞‡∏£‡∏≤‡∏¢‡πÉ‡∏ö
        for(let i=0; i<5; i++) {
            const eVal = eDeck[i];
            const pVal = placedCards[i];
            
            const eCardEl = document.getElementById(`eCard${i}`);
            eCardEl.textContent = eVal;
            eCardEl.classList.add('revealed');
            beep(800, 'triangle');
            
            await sleep(400);

            const pSlot = document.querySelector(`.clash-slot[data-id="${i}"]`);
            
            if (pVal > eVal) {
                // Player ‡∏ä‡∏ô‡∏∞‡∏ï‡∏≤‡∏ô‡∏µ‡πâ
                addX(eCardEl);
                eCardEl.classList.add('card-dead');
                pSurvivors.push(pVal);
            } else if (eVal > pVal) {
                // Enemy ‡∏ä‡∏ô‡∏∞‡∏ï‡∏≤‡∏ô‡∏µ‡πâ
                addX(pSlot);
                pSlot.querySelector('div').style.filter = "brightness(0.3)";
                eSurvivors.push(eVal);
            } else {
                // ‡πÄ‡∏™‡∏°‡∏≠ -> ‡∏ï‡∏≤‡∏¢‡∏Ñ‡∏π‡πà
                addX(eCardEl); eCardEl.classList.add('card-dead');
                addX(pSlot); pSlot.querySelector('div').style.filter = "brightness(0.3)";
            }
            await sleep(600);
        }

        // --- ‡∏à‡∏ö 5 ‡πÉ‡∏ö ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢ ---
        const pCount = pSurvivors.length;
        const eCount = eSurvivors.length;
        
        await sleep(500);

        if (pCount > eCount) {
            // ‡πÄ‡∏£‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏¢‡∏≠‡∏∞‡∏Å‡∏ß‡πà‡∏≤ -> ‡πÄ‡∏£‡∏≤‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏ù‡πà‡∏≤‡∏¢‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            const dmg = pSurvivors.reduce((a, b) => a + b, 0);
            eHP -= dmg;
            flashDamage('e', dmg);
            highlightSurvivors('clash-slot', placedCards, pSurvivors);
        } else if (eCount > pCount) {
            // ‡∏ö‡∏≠‡∏™‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏¢‡∏≠‡∏∞‡∏Å‡∏ß‡πà‡∏≤ -> ‡∏ö‡∏≠‡∏™‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏ù‡πà‡∏≤‡∏¢‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            const dmg = eSurvivors.reduce((a, b) => a + b, 0);
            pHP -= dmg;
            flashDamage('p', dmg);
            highlightSurvivors('enemy', eDeck, eSurvivors);
        } else {
            // --- ‡∏Å‡∏£‡∏ì‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏î‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô (‡∏™‡∏ß‡∏ô‡∏´‡∏°‡∏±‡∏î) ---
            const pDmg = pSurvivors.reduce((a, b) => a + b, 0); // ‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠
            const eDmg = eSurvivors.reduce((a, b) => a + b, 0); // ‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡∏ö‡∏≠‡∏™‡πÄ‡∏´‡∏•‡∏∑‡∏≠
            
            // ‡πÅ‡∏•‡∏Å‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢!
            eHP -= pDmg;
            pHP -= eDmg;
            
            flashDamage('e', pDmg); // ‡∏ö‡∏≠‡∏™‡πÇ‡∏î‡∏ô‡∏î‡∏≤‡πÄ‡∏°‡∏à‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏≤
            
            // ‡∏£‡∏≠‡πÅ‡∏õ‡∏õ‡∏ô‡∏∂‡∏á‡∏Ñ‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡πÇ‡∏î‡∏ô‡∏ö‡πâ‡∏≤‡∏á (‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏±‡∏î‡πÜ)
            setTimeout(() => {
                flashDamage('p', eDmg); // ‡πÄ‡∏£‡∏≤‡πÇ‡∏î‡∏ô‡∏î‡∏≤‡πÄ‡∏°‡∏à‡∏à‡∏≤‡∏Å‡∏ö‡∏≠‡∏™
            }, 300);

            highlightSurvivors('clash-slot', placedCards, pSurvivors);
            highlightSurvivors('enemy', eDeck, eSurvivors);
        }

        updateUI();
        await sleep(1500);
        checkEndGame();
    }

    function highlightSurvivors(className, allCards, survivorValues) {
        if (className === 'enemy') {
            for(let i=0; i<5; i++) {
                const el = document.getElementById(`eCard${i}`);
                if (!el.classList.contains('card-dead')) {
                    el.classList.add('safe');
                }
            }
        } else {
            for(let i=0; i<5; i++) {
                const el = document.querySelector(`.clash-slot[data-id="${i}"] div`);
                if (el && el.style.filter === "") {
                    el.parentElement.classList.add('active');
                    el.parentElement.style.border = "2px solid yellow";
                    el.parentElement.style.boxShadow = "0 0 15px yellow";
                    el.style.color = "yellow";
                    el.style.background = "black";
                }
            }
        }
    }

    function flashDamage(who, amount) {
        if(amount <= 0) return;
        const box = document.getElementById(who === 'e' ? 'eHpBox' : 'pHpBox');
        const txt = document.getElementById(who === 'e' ? 'eDmgText' : 'pDmgText');
        
        txt.textContent = "-" + amount;
        txt.classList.add('show');
        box.style.borderColor = 'white';

        beep(100, 'sawtooth');

        setTimeout(() => {
            txt.classList.remove('show');
            box.style.borderColor = who === 'e' ? '#333' : '#00ff41';
        }, 1000);
    }

    function addX(target) {
        const x = document.createElement('div');
        x.className = 'x-mark';
        x.textContent = 'X';
        x.style.top = '50%'; x.style.left = '50%';
        x.style.transform = 'translate(-50%, -50%)';
        target.style.position = 'relative'; 
        target.appendChild(x);
    }

    function updateUI() {
        if(pHP < 0) pHP = 0;
        if(eHP < 0) eHP = 0;
        document.getElementById('playerHpBar').style.width = (pHP/MAX_HP)*100 + "%";
        document.getElementById('playerHpText').textContent = pHP + "/" + MAX_HP;
        document.getElementById('enemyHpBar').style.width = (eHP/MAX_HP)*100 + "%";
        document.getElementById('enemyHpText').textContent = eHP + "/" + MAX_HP;
    }

    function checkEndGame() {
        if (pHP > 0 && eHP > 0) {
            const btn = document.getElementById('actionBtn');
            btn.textContent = "NEXT ROUND";
            btn.disabled = false;
            btn.classList.remove('attack');
            btn.classList.add('main-btn');
            btn.onclick = nextRound;
        } else {
            const modal = document.getElementById('resultModal');
            const title = document.getElementById('resultTitle');
            const sub = document.getElementById('resultSub');
            
            if (pHP === 0 && eHP === 0) {
                title.textContent = "SUDDEN DEATH";
                title.style.color = "yellow";
                sub.textContent = "DOUBLE KO";
            } else if (pHP === 0) {
                title.textContent = "YOU LOSE";
                title.style.color = "red";
                sub.textContent = "BETTER LUCK NEXT TIME";
            } else {
                title.textContent = "YOU WIN!";
                title.style.color = "#00ff41";
                sub.textContent = "REWARD: 0.001 WLD";
            }
            modal.style.display = 'flex';
        }
    }

    function nextRound() {
        currentTurn = 0;
        placedCards = [null, null, null, null, null];
        isPlaying = false;
        
        const cZone = document.getElementById('clashZone');
        cZone.innerHTML = '';
        for(let i=0; i<5; i++) {
            const slot = document.createElement('div');
            slot.className = i===0 ? 'clash-slot active' : 'clash-slot';
            slot.dataset.id = i;
            cZone.appendChild(slot);
        }
        
        const eRow = document.getElementById('enemyCardRow');
        eRow.innerHTML = '';
        for(let i=0; i<5; i++) {
            eRow.innerHTML += `<div class="card enemy" id="eCard${i}">?</div>`;
        }
        
        pDeck = getShuffledDeck();
        eDeck = getShuffledDeck();
        
        const pRow = document.getElementById('playerCardRow');
        pRow.innerHTML = '';
        pDeck.forEach((val) => {
            const card = document.createElement('div');
            card.className = 'card my-card';
            card.textContent = val;
            card.onclick = () => playCard(val, card);
            pRow.appendChild(card);
        });
        
        const btn = document.getElementById('actionBtn');
        btn.textContent = "SELECT CARDS";
        btn.disabled = true;
        btn.onclick = null;
        
        beep(600, 'square');
    }

    function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

    initGame(); 
</script>
</body>
</html>
