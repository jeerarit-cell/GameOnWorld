<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CYBER RPG v2.8 (Reborn)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;600&family=Orbitron:wght@700;900&display=swap');

        :root {
            --neon-orange: #ff9d00;
            --neon-blue: #00eaff;
            --neon-red: #ff2a2a;
            --bg-dark: #050505;
            --bg-white: #f8f9fa;
            --card-width: 54px;
            --card-height: 76px;
            --gap: 6px;
            --total-width: calc((var(--card-width) * 5) + (var(--gap) * 4));
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; outline: none; }
        
        body {
            margin: 0; padding: 0;
            background-color: #000;
            font-family: 'Kanit', sans-serif;
            width: 100vw; height: 100vh;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }

        .app-container {
            width: 100%; height: 100%; max-width: 480px;
            background-color: var(--bg-dark);
            position: relative; display: flex; flex-direction: column;
            box-shadow: 0 0 50px rgba(0,0,0,0.5); overflow: hidden;
        }

        .screen { position: absolute; inset: 0; display: none; flex-direction: column; background-size: cover; background-position: center; }
        .screen.active { display: flex; z-index: 999; }
        .screen-white { background-color: var(--bg-white) !important; color: #333; padding: 20px; overflow-y: auto; background-image: none !important; }

        /* --- BACKGROUNDS --- */
        #screen-login { background-image: url('https://github.com/user-attachments/assets/c9b596d6-88ee-4ca0-bf0a-a80b17ab31f0'); }
        #screen-lobby { background-image: url('https://github.com/user-attachments/assets/70b3047d-bbea-42b8-a8bd-96fe08c69f03'); }

        /* --- GLOBAL UI --- */
        .white-header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-top: 5px; color: #333; }
        .close-btn { font-size: 1.5rem; color: #aaa; cursor: pointer; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background:rgba(255,255,255,0.1); backdrop-filter:blur(5px); }
        .btn { background: linear-gradient(180deg, var(--neon-orange), #d35400); border: none; border-radius: 8px; color: #fff; font-weight: 600; cursor: pointer; padding: 10px; width:100%; font-family: 'Kanit'; }
        
        /* AD BANNER */
        .ad-banner {
            width: 100%; max-width: 380px; height: 100px;
            background: #222; margin: 10px auto;
            border-radius: 8px; border: 1px solid #444;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; position: relative;
            flex-shrink: 0; /* (‡∏Ç‡πâ‡∏≠ 3) ‡∏´‡πâ‡∏≤‡∏°‡∏´‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏ó‡∏£‡∏á */
        }
        .ad-banner img { width: 100%; height: 100%; object-fit: cover; }
        .ad-tag { position: absolute; top: 0; right: 0; background: rgba(0,0,0,0.5); color: white; font-size: 0.6rem; padding: 2px 5px; }

        /* üé• VIDEO BOX (‡∏Ç‡πâ‡∏≠ 1) */
        .video-box {
            width: 100%; max-width: 380px; height: 100px;
            margin: 0 auto 20px auto;
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 234, 255, 0.4);
            background: #000;
            position: relative;
            flex-shrink: 0; /* ‡∏´‡πâ‡∏≤‡∏°‡∏´‡∏î */
        }
        .video-label {
            position: absolute; top: 0; left: 0;
            background: var(--neon-blue); color: #000;
            font-family: 'Orbitron'; font-size: 0.5rem; font-weight: bold;
            padding: 2px 6px; z-index: 10;
        }

        /* LOBBY UI */
        .top-bar { height: 70px; background: linear-gradient(180deg, rgba(0,0,0,0.6), transparent); display: flex; align-items: center; padding: 0 15px; gap: 10px; flex-shrink: 0; color: white; text-shadow: 1px 1px 2px black; }
        .avatar { width: 50px; height: 50px; border: 2px solid var(--neon-orange); border-radius: 50%; background: #333; overflow: hidden; }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }
        
        /* (‡∏Ç‡πâ‡∏≠ 2) ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ */
        .lobby-content { 
            flex: 1; /* ‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
            overflow-y: auto; /* ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏•‡∏á */
            width: 100%;
            display: flex; flex-direction: column; align-items: center; 
            padding-bottom: 20px; 
        }
        
        /* (‡∏Ç‡πâ‡∏≠ 3) ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏° Map ‡∏•‡∏≠‡∏¢ */
        .bottom-nav { 
            height: 80px;
           /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏î‡∏≥‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÅ‡∏™‡∏á */
            background:  var( --neon-orange);
            backdrop-filter: blur(10px); /* ‡πÉ‡∏™‡πà‡πÄ‡∏ö‡∏•‡∏≠‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÑ‡∏Æ‡πÄ‡∏ó‡∏Ñ */
    
            /* ‡πÉ‡∏™‡πà‡∏Ç‡∏≠‡∏ö‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÅ‡∏™‡∏á‡∏™‡∏µ‡∏™‡πâ‡∏° (‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° Hunt) */
               border: 3px solid  var(--neon-blue);
            box-shadow: 0 0 20px rgba(255, 157, 0, 0.2); /* ‡πÅ‡∏™‡∏á‡∏ü‡∏∏‡πâ‡∏á‡πÜ */
    
            margin: 0 15px 25px 15px;
           border-radius: 30px;
            display: flex; justify-content: center; 
           align-items: center;
           position: relative;
           z-index: 100; flex-shrink: 0;  animation: pulse 2s infinite; 
}
        .nav-item { 
           text-align: center; 
    color: var(--neon-blue);
    
    /* üîß ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö */
    font-size: 2rem;      /* ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô (‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏° 0.9) */
    font-weight: 900;       /* ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤‡∏™‡∏∏‡∏î */
    letter-spacing: 4px;    /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÅ‡∏û‡∏á */
    text-transform: uppercase; /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏ç‡πà‡∏´‡∏°‡∏î */
   
    font-family: 'Orbitron'; cursor: pointer; 
    transition: 0.3s;
    width: 100%; /* ‡πÉ‡∏´‡πâ‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡πá‡∏°‡∏õ‡∏∏‡πà‡∏° */
    text-shadow: 0 0 5px rgba(0,0,0,0.5); animation: pulse 2s infinite;
}
       
        .nav-item.active { 
           color: var(--neon-orange); /* ‡∏™‡∏µ‡∏™‡πâ‡∏°‡∏ï‡∏≠‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
    transform: translateY(-2px) scale(1.1); /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á */
    font-weight: bold;
    text-shadow: 0 0 10px var(--neon-orange); /* ‡πÉ‡∏™‡πà‡πÄ‡∏á‡∏≤‡πÅ‡∏™‡∏á‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ */
}

        .marquee-container { background: rgba(0,0,0,0.6); border: 1px solid var(--neon-blue); border-radius: 4px; height: 30px; display: flex; align-items: center; overflow: hidden; white-space: nowrap; position: relative; margin: 10px 10px 0 10px; flex-shrink: 0; }
        .marquee-text { display: inline-block; padding-left: 100%; animation: scroll-left 15s linear infinite; color: var(--neon-blue); font-size: 0.8rem; font-family: 'Kanit'; }
        @keyframes scroll-left { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* MAP UI */
        .monster-card { border-radius: 12px; margin-bottom: 10px; padding: 12px; display: flex; align-items: center; justify-content: space-between; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.3); cursor: pointer; position: relative; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); transition: transform 0.1s; }
        .monster-card:active { transform: scale(0.98); }
        .rank-common { background: linear-gradient(135deg, #2c3e50, #4ca1af); }
        .rank-miniboss { background: linear-gradient(135deg, #1e3c72, #2a5298); border: 1px solid var(--neon-blue); }
        .rank-boss { background: linear-gradient(135deg, #8E0E00, #1F1C18); border: 2px solid #ffd700;} 
        .rank-legendary { background: linear-gradient(135deg, #FFD700, #FF8C00);  border: 2px solid white;  box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);  animation: goldPulse 2s infinite; }
        @keyframes goldPulse {
        0% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }
        50% { box-shadow: 0 0 30px rgba(255, 215, 0, 1); border-color: #fff; }
        100% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }
}
        .m-avatar { width: 50px; height: 50px; border-radius: 8px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.3); object-fit: cover; margin-right: 15px; }
        .m-info h3 { margin: 0; font-family: 'Orbitron'; font-size: 1rem; }
        .hp-badge { background: rgba(0,0,0,0.6); padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-family: 'Orbitron'; border: 1px solid rgba(255,255,255,0.2); min-width: 60px; text-align: center; }

        /* BATTLE CSS */
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }
        .shaking { animation: shake 0.5s; }
        .battle-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px; padding: 10px; }
        .game-column { width: var(--total-width); display: flex; flex-direction: column; gap: 6px; }
        .boss-banner { width: 100%; height: 80px; border: 1px solid white; border-radius: 8px; overflow: hidden; background: #000; position: relative; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
        .boss-banner img { width: 100%; height: 100%; object-fit: cover; opacity: 0.9; }
        .boss-banner.hit { border-color: red; animation: shake 0.2s; }
        .hp-wrapper { position: relative; width: 100%; margin: 2px 0; }
        .hp-container { width: 100%; height: 20px; background: #222; border: 1px solid white; border-radius: 4px; overflow: hidden; position: relative; }
        .hp-fill { height: 100%; width: 100%; transition: width 0.2s; }
        .hp-enemy { background: linear-gradient(90deg, #ff3333, #aa0000); }
        .hp-player { background: linear-gradient(90deg, #00eaff, #0066cc); }
        .hp-text { position: absolute; width: 100%; text-align: center; top: 0; font-size: 12px; line-height: 20px; color: #fff; font-weight: 900; text-shadow: 1px 1px 2px black; font-family: 'Orbitron'; letter-spacing: 1px; }
        .dmg-float { position: absolute; color: #fff; font-weight: 900; font-size: 2.5rem; text-shadow: 2px 2px 0 #ff0000; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); opacity: 0; transition: 0.3s; z-index: 50; font-family: 'Orbitron'; pointer-events: none; }
        .dmg-float.show { opacity: 1; transform: translate(-50%, -100%) scale(1); }
        .card-row { display: flex; gap: var(--gap); justify-content: center; width: 100%; height: 80px; margin-top: 4px; }
        .card-perspective { width: var(--card-width); height: var(--card-height); perspective: 1000px; flex-shrink: 0; }
        .card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; border-radius: 6px; }
        .card-perspective.flipped .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-family: 'Orbitron'; font-size: 1.6rem; border: 1px solid white; box-shadow: 0 4px 6px rgba(0,0,0,0.5); }
        .card-front { background-color: #1a1a1a; background-image: url('https://images.unsplash.com/photo-1615818386470-3430ee8b3079?q=80&w=200'); background-size: cover; background-position: center; }
        .card-back { background: linear-gradient(135deg, #eee, #ccc); color: #000; transform: rotateY(180deg); font-weight: 900; }
        .card-perspective.flipped .card-back.enemy-revealed { background: linear-gradient(135deg, var(--neon-red), #990000); color: white; border: 1px solid white; box-shadow: 0 0 10px var(--neon-red); }
        .clash-zone { width: var(--total-width); height: 90px; display: flex; gap: var(--gap); justify-content: center; align-items: center; border-top: 1px solid rgba(255,255,255,0.2); border-bottom: 1px solid rgba(255,255,255,0.2); }
        .clash-slot { width: var(--card-width); height: var(--card-height); border: 1px solid rgba(255,255,255,0.4); border-radius: 6px; display: flex; align-items: center; justify-content: center; background: transparent; position: relative; flex-shrink: 0; }
        .clash-slot.active { border: 2px solid #fff; background: rgba(0, 234, 255, 0.15); box-shadow: 0 0 15px rgba(0, 234, 255, 0.3); }
        .clash-slot div { width: 100%; height: 100%; background:var(--neon-blue); color: #000; border-radius: 4px; border: 1px solid white; display: flex; align-items: center; justify-content: center; font-family: 'Orbitron'; font-size: 1.6rem; font-weight: 900; }
        .my-card { width: var(--card-width); height: var(--card-height); flex-shrink: 0; border: 1px solid white; color: var(--neon-orange); background: #111; cursor: pointer; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-family: 'Orbitron'; font-size: 1.6rem; }
        .my-card.selected { transform: translateY(-12px); background: var(--neon-orange); color: #000; border-color: white; box-shadow: 0 0 15px var(--neon-orange); }
        .my-card.used { opacity: 0; pointer-events: none; }
        .main-btn { width: 100%; height: 50px; margin-top: 4px; background: linear-gradient(180deg, var(--neon-blue), #0066cc); border: 1px solid white; border-radius: 6px; font-family: 'Orbitron'; font-size: 1.2rem; color: #fff; font-weight: 900; letter-spacing: 2px; cursor: pointer; box-shadow: 0 4px 0 #004488; transition: 0.1s; text-transform: uppercase; }
        .main-btn:active { transform: translateY(4px); box-shadow: none; }
        .main-btn:disabled { background: #333; color: white; border-color: white; box-shadow: none; cursor: default; }
        .main-btn.attack { background: linear-gradient(180deg, #ff3333, #990000); color: white; box-shadow: 0 4px 0 #550000; }
        .main-btn.sudden { background: yellow; color: black; box-shadow: 0 4px 0 #aaaa00; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }
        @keyframes safeWinFlash { 0%, 100% { border-color: white; box-shadow: 0 0 5px rgba(255, 255, 255, 0.3); } 50% { border-color: #fff700; box-shadow: 0 0 40px #fff700, inset 0 0 20px #fff700; } }
        .win-pulse { animation: safeWinFlash 0.6s infinite linear !important; z-index: 100; position: relative; }
        .dead-content { filter: brightness(0.4) !important; transition: filter 0.5s ease; }
        .modal { position: absolute; inset: 0; background: rgba(0,0,0,0.92); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 100; backdrop-filter: blur(5px); }
        .glow-text { animation: textGlow 1.5s infinite alternate; font-family: 'Orbitron'; font-size: 3rem; color:white; }
        @keyframes textGlow { from { text-shadow: 0 0 10px var(--neon-orange); } to { text-shadow: 0 0 30px var(--neon-orange), 0 0 10px white; } }
    </style>
</head>
<body>
    
    <div class="app-container">
        
        <div id="screen-login" class="screen active" style="justify-content: center; align-items: center;">
            <div style="font-family: 'Orbitron'; font-size: 3rem; text-align: center; color:white; text-shadow: 0 0 20px var(--neon-orange); margin-bottom: 20px;">
                PROJECT<br><span style="color:var(--neon-orange)">CHASER</span>
            </div>
            <button class="btn" style="width: 200px;" onclick="startGameAndAudio()">JOIN GAME</button>
        </div>

        <div id="screen-lobby" class="screen">
           <div class="top-bar">
                <div class="avatar"><img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?q=80&w=200"></div>
                <div style="margin-left: 12px; display: flex; flex-direction: column; justify-content: center; min-width: 140px;">
                    
                    <div style="font-family:'Orbitron'; font-size: 1rem; line-height: 1.2;">
                        PLAYER_1 
                        <span id="uiLevel" style="background:#333; padding:1px 6px; border-radius:4px; font-size:0.7rem; color:#00eaff; vertical-align: middle;">LV.1</span>
                    </div>

                    <div style="font-size: 0.75rem; margin: 3px 0; white-space: nowrap;">
                        <span style="color:#ff2a2a; font-weight:bold;">‚ù§ <span id="uiLobbyHP">20/20</span></span>
                        <span style="color:#444; margin: 0 4px;">|</span>
                        <span id="uiExp" style="color:#888;">0/150 XP</span>
                    </div>

                    <div style="font-size: 0.9rem; line-height: 1;">
                        <span style="color:var(--neon-orange); font-weight:bold;" id="uiWLD">100.00</span> COIN
                    </div>
                </div>
            </div>
            
            <div class="marquee-container"><div class="marquee-text">üéâ EVENT: ‡∏ó‡∏≠‡∏™‡∏≠‡∏öüòäüòäüòä</div></div>
            
            <div class="ad-banner" onclick="window.open('https://www.youtube.com/watch?v=7YtWwxA9sC4')" style="cursor: pointer;">
                <img src="https://github.com/user-attachments/assets/95431a34-e841-4114-967c-797641a63055">
                <div class="ad-tag">AD</div>
            </div>

            <div class="lobby-content">
                <div class="video-box">
                    <div class="video-label">LIVE FEED</div>
                    <iframe 
                        width="100%" 
                        height="100%" 
                        src="https://www.youtube.com/embed/2ohNHqSTu0w?autoplay=1&loop=1&playlist=2ohNHqSTu0w&mute=1&controls=1&showinfo=0&modestbranding=1" 
                        title="YouTube video player" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                        allowfullscreen>
                    </iframe>
                </div>
            </div>

            <div class="bottom-nav">
                <div class="nav-item active" onclick="nav('map')">START GAME </div>
            </div>
        </div>

        <div id="screen-map" class="screen screen-white">
            <div class="white-header-bar">
                <h2 style="margin:0; font-family:'Orbitron';">MONSTER HUNT</h2>
                <div class="close-btn" onclick="nav('home')">‚úï</div>
            </div>
            <div id="monster-list-container" style="padding-bottom: 80px;"></div>
        </div>

        <div id="screen-battle" class="screen">
            <div class="header" style="height: 50px; background: rgba(0,0,0,0.8); display:flex; justify-content:center; align-items:center; padding:0 20px; border-bottom:1px solid #333;">
                <div style="color:white; font-family:'Orbitron'; font-size:1.2rem;">VS <span id="battleEnemyName" style="color:red;">ENEMY</span></div>
            </div>

            <div class="battle-area" id="battleArea">
                <div class="game-column">
                    <div class="boss-banner" id="bossBanner">
                        <img id="bossImg" src="" alt="Boss">
                    </div>
                    <div class="hp-wrapper">
                        <div class="hp-container">
                            <div class="hp-fill hp-enemy" id="enemyHpBar"></div>
                            <div class="hp-text" id="enemyHpText">20/20</div>
                        </div>
                        <div class="dmg-float" id="eDmgText">-0</div>
                    </div>
                    <div class="card-row" id="enemyCardRow"></div>
                </div>

                <div class="clash-zone" id="clashZone"></div>

                <div class="game-column player-zone">
                    <div class="hp-wrapper">
                        <div class="hp-container">
                            <div class="hp-fill hp-player" id="playerHpBar"></div>
                            <div class="hp-text" id="playerHpText">20/20</div>
                        </div>
                        <div class="dmg-float" id="pDmgText">-0</div>
                    </div>
                    <div class="card-row" id="playerCardRow"></div>
                    <button id="actionBtn" class="main-btn">SELECT CARDS</button>
                </div>
            </div>

            <div id="resultModal" class="modal">
                <h1 id="resultTitle" class="glow-text">WIN</h1>
                <p id="resultSub" style="color:white;">REWARD: 100 COINS</p>
                <button id="restartBtn" class="main-btn" style="width:220px; margin-top:30px;">CONTINUE</button>
            </div>
        </div>

    </div>

    <script>
          // ==========================================
    //  CYBER RPG SYSTEM V3.0 (Save & Auto-Fix)
    // ==========================================

    // --- 1. GLOBAL VARIABLES ---
    let playerCOIN = 100.00;
    let playerMaxHP = 28;       
    let playerCurrentHP = 28;   
    
    // Level System
    let playerLevel = 5;
    let playerEXP = 999;
    let currentMonsterType = 'common'; 

    // Config
    const levelConfig = {
        1: { need: 150 }, 2: { need: 300 }, 3: { need: 450 },
        4: { need: 700 }, 5: { need: 1000 }
    };
    const expReward = { 'common': 1, 'miniboss': 2, 'boss': 3, 'legendary': 5 };

    // --- 2. MONSTER DATABASE ---
    const monsterDB = [
        { id: 1, name: "Duck Fighter",    hp: 20,  type: "common",   loc: "Sewers",  url:"https://images.unsplash.com/photo-1459682687441-7761439a709d?q=80&w=500" },
        { id: 2, name: "Dog Fighter",   hp: 20,  type: "common",   loc: "Sewers",  url:"https://github.com/user-attachments/assets/4740cb53-19dd-4186-9c7f-d8af3e3aaddb" },
        { id: 3, name: "Scorpion Fighter",   hp: 20,  type: "common",   loc: "Digital", url:"https://github.com/user-attachments/assets/43953afd-66b6-4ae5-83b9-6121ba7ff05d" },
        { id: 4, name: "Rabbit Fighter",   hp: 20,  type: "common",   loc: "Digital", url:"https://github.com/user-attachments/assets/912e9583-da84-4f1a-adce-e9fe5ae54490" },
        { id: 5, name: "Wolf Fighter",   hp: 20,  type: "common",   loc: "Digital", url:"https://github.com/user-attachments/assets/8e3523b7-7ed7-4d27-b6cf-2f10373738e9" },
        { id: 6, name: "Fire Gobin",  hp: 30,  type: "miniboss", loc: "Factory", url:"https://github.com/user-attachments/assets/8a354949-f700-4d7e-9ff4-dd5b90164296" }, 
        { id: 7, name: "THE OVERLORD", hp: 40,  type: "boss",    loc: "Tower",   url:"https://github.com/user-attachments/assets/6dec1453-a3f9-4b8f-8499-ac45bd42da29" },
        { id: 8, name: "GOLDEN DRAGON", hp: 50,  type: "legendary",   loc: "Sky Realm",   url:"https://github.com/user-attachments/assets/b8379da1-b55e-4c8f-bcfb-e68eaae581ed" }
    ];

    // --- 3. SAVE / LOAD SYSTEM (‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç V3.0) ---
    function saveGame() {
        const gameData = {
            coin: playerCOIN,
            level: playerLevel,
            exp: playerEXP,
            hp: playerCurrentHP // ‡πÄ‡∏ã‡∏ü‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢
        };
        localStorage.setItem('CyberRPG_Save', JSON.stringify(gameData));
        console.log("Game Saved!");
    }

    function loadGame() {
        const saved = localStorage.getItem('CyberRPG_Save');
        if (saved) {
            const data = JSON.parse(saved);
            playerCOIN = parseFloat(data.coin) || 100.00;
            playerLevel = parseInt(data.level) || 1;
            playerEXP = parseInt(data.exp) || 0;
            
            // ‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì MaxHP ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡πä‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏î 12)
            // ‡∏ê‡∏≤‡∏ô 20 + ((Level-1) * 2)
            playerMaxHP = 20 + ((playerLevel - 1) * 2);

            // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÄ‡∏Å‡∏¥‡∏ô Max ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏≤‡∏¢‡∏Ñ‡∏≤‡πÄ‡∏ã‡∏ü
            playerCurrentHP = parseInt(data.hp) || playerMaxHP;
            if(playerCurrentHP > playerMaxHP) playerCurrentHP = playerMaxHP;
            if(playerCurrentHP <= 0) playerCurrentHP = playerMaxHP; // ‡∏ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏¢‡∏Ñ‡∏≤‡πÄ‡∏ã‡∏ü ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÄ‡∏ï‡πá‡∏°
        }
    }

    function resetGameData() {
        if(confirm("‡∏•‡∏ö‡πÄ‡∏ã‡∏ü‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà? (Delete Save?)")) {
            localStorage.removeItem('CyberRPG_Save');
            location.reload();
        }
    }

    // --- 4. STARTUP & AUDIO ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function startGameAndAudio() {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° Reset ‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏≤‡∏Å‡∏•‡∏ö‡πÄ‡∏ã‡∏ü)
        if(!document.getElementById('btnReset')) {
            const rBtn = document.createElement('button');
            rBtn.id = 'btnReset';
            rBtn.innerText = "üóëÔ∏è RESET";
            rBtn.style.cssText = "position:absolute; top:10px; right:10px; z-index:2000; background:red; color:white; border:none; padding:5px; font-size:0.6rem; cursor:pointer;";
            rBtn.onclick = resetGameData;
            document.body.appendChild(rBtn);
        }

        updateLobbyStats();
        updateBalance();
        nav('home');
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ
    window.onload = () => {
        loadGame();
        updateLobbyStats();
        updateBalance();
    };

    function playSfx(type) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        const now = audioCtx.currentTime;
        osc.connect(gain); gain.connect(audioCtx.destination);
        
        if (type === 'click') {
            osc.frequency.setValueAtTime(800, now); gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
        } else if (type === 'place') {
            osc.frequency.setValueAtTime(200, now); gain.gain.linearRampToValueAtTime(0, now + 0.1);
        } else if (type === 'hit') {
            osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, now); osc.frequency.exponentialRampToValueAtTime(10, now + 0.4); gain.gain.linearRampToValueAtTime(0, now + 0.4);
        } else if (type === 'win') {
            osc.type = 'triangle'; osc.frequency.setValueAtTime(440, now); osc.frequency.setValueAtTime(554, now + 0.1); gain.gain.linearRampToValueAtTime(0, now + 0.5);
        }
        osc.start(now); osc.stop(now + 0.5);
    }

    // --- 5. UI LOGIC ---
    function updateBalance() { 
        const el = document.getElementById('uiWLD');
        if(el) el.innerText = playerCOIN.toFixed(2); 
    }

    function updateLobbyStats() {
        const elLevel = document.getElementById('uiLevel');
        const elExp = document.getElementById('uiExp');
        const elHP = document.getElementById('uiLobbyHP');

        // Check Logic: Max Level
        if (!levelConfig[playerLevel]) {
            if(elLevel) {
                elLevel.innerText = "LV.MAX";
                elLevel.style.color = "#ffd700"; 
                elLevel.style.border = "1px solid #ffd700";
            }
            if(elExp) elExp.innerText = "----/---- XP";
        } else {
            if(elLevel) {
                elLevel.innerText = "LV." + playerLevel;
                elLevel.style.color = "#00eaff"; 
                elLevel.style.border = "none";
            }
            if(elExp) {
                const nextNeed = levelConfig[playerLevel].need;
                elExp.innerText = `${playerEXP}/${nextNeed} XP`;
            }
        }
        if(elHP) elHP.innerText = `${playerCurrentHP}/${playerMaxHP}`;
    }
    
    function nav(target) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        let screenId = 'screen-' + target;
        if(target === 'home') screenId = 'screen-lobby';
        const targetScreen = document.getElementById(screenId);
        if(targetScreen) targetScreen.classList.add('active');

        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        if(target === 'map') document.querySelector('.nav-item').classList.add('active');
        
        updateBalance();
        updateLobbyStats();
    }

    function initMap() {
        const container = document.getElementById('monster-list-container');
        if(!container) return;
        container.innerHTML = '';
        monsterDB.forEach(m => {
            let cardClass = 'rank-common';
            let badgeStyle = '';
            let infoExtra = '';
            if(m.type === 'miniboss') { cardClass = 'rank-miniboss'; badgeStyle = 'color:#00eaff; border-color:#00eaff;'; infoExtra = '<p style="color:#00eaff; font-size:0.7rem; font-weight:bold;">‚òÖ MINI BOSS</p>'; }
            else if (m.type === 'boss') { cardClass = 'rank-boss'; badgeStyle = 'background:#ffd700; color:black; font-weight:bold; border:none;'; infoExtra = '<p style="color:#ffd700; font-weight:bold; font-size:0.7rem;">‚ò†Ô∏è WORLD BOSS</p>'; }
            else if (m.type === 'legendary') { cardClass = 'rank-legendary'; badgeStyle = 'background:white; color:#FF8C00; font-weight:900; border:none; box-shadow: 0 0 10px white;'; infoExtra = '<p style="color:white; font-weight:900; font-size:0.8rem; text-shadow: 0 1px 2px black;">üëë LEGENDARY BOSS</p>'; }

            const cardHTML = `
                <div class="monster-card ${cardClass}" onclick="prepareBattle(${m.id})">
                    <div style="display:flex; align-items:center;">
                        <img src="${m.url}" class="m-avatar">
                        <div class="m-info"><h3>${m.name}</h3>${infoExtra}<p>${m.loc} ‚Ä¢ HP: ${m.hp}</p></div>
                    </div>
                    <div class="hp-badge" style="${badgeStyle}">HP: ${m.hp}</div>
                </div>`;
            container.innerHTML += cardHTML;
        });
    }

    // --- 6. BATTLE SYSTEM ---
    let battle_eMaxHP = 20;
    let battle_eHP = 20;
    let battle_pDeck = [], battle_eDeck = [];
    let battle_placedCards = [null, null, null, null, null];
    let battle_turn = 0;
    let battle_isPlaying = false;

    function prepareBattle(monsterID) {
        const monster = monsterDB.find(m => m.id === monsterID);
        if(!monster) return;

        currentMonsterType = monster.type;
        battle_eMaxHP = monster.hp;
        battle_eHP = monster.hp;
        document.getElementById('battleEnemyName').innerText = monster.name;
        document.getElementById('bossImg').src = monster.url;

        document.getElementById('screen-battle').style.backgroundImage = "url('https://github.com/user-attachments/assets/13b147e2-f363-49ce-bd43-68530d231a60')";

        nav('battle');
        initBattleState();
    }

    function initBattleState() {
        battle_turn = 0;
        battle_placedCards = [null, null, null, null, null];
        battle_isPlaying = false;
        document.getElementById('resultModal').style.display = 'none';
        updateBattleUI();
        
        const currentImg = document.getElementById('bossImg').src;
        const cZone = document.getElementById('clashZone'); cZone.innerHTML = '';
        for(let i=0; i<5; i++) {
            const slot = document.createElement('div');
            slot.className = i===0 ? 'clash-slot active' : 'clash-slot';
            slot.dataset.id = i;
            cZone.appendChild(slot);
        }

        const eRow = document.getElementById('enemyCardRow'); eRow.innerHTML = '';
        for(let i=0; i<5; i++) {
            const wrap = document.createElement('div'); wrap.className = 'card-perspective'; wrap.id = `eWrap${i}`;
            wrap.innerHTML = `<div class="card-inner"><div class="card-front"style="background-image:url('${currentImg}');background-size:cover; background-position:center;"></div><div class="card-back enemy-revealed" id="eCard${i}">?</div></div>`;
            eRow.appendChild(wrap);
        }

        battle_pDeck = [1, 2, 3, 4, 5].sort(() => Math.random() - 0.5);
        battle_eDeck = [1, 2, 3, 4, 5].sort(() => Math.random() - 0.5); 
        
        const pRow = document.getElementById('playerCardRow'); pRow.innerHTML = '';
        battle_pDeck.forEach((val) => {
            const card = document.createElement('div');
            card.className = 'my-card';
            card.textContent = val;
            card.onclick = () => selectCardAction(val, card);
            pRow.appendChild(card);
        });

        const btn = document.getElementById('actionBtn');
        btn.textContent = "SELECT CARDS"; btn.disabled = true; btn.className = 'main-btn';
        btn.onclick = null;
        playSfx('place');
    }

    function selectCardAction(val, el) {
        if(battle_isPlaying || battle_turn >= 5 || el.classList.contains('used')) return;
        battle_placedCards[battle_turn] = val;
        playSfx('click');
        
        const slot = document.querySelector(`.clash-slot[data-id="${battle_turn}"]`);
        slot.innerHTML = `<div>${val}</div>`;
        slot.classList.remove('active');
        el.classList.add('used');
        
        battle_turn++;
        if(battle_turn < 5) {
            document.querySelector(`.clash-slot[data-id="${battle_turn}"]`).classList.add('active');
        } else {
            const btn = document.getElementById('actionBtn');
            btn.textContent = "ATTACK !!!"; btn.disabled = false;
            btn.classList.add('attack'); 
            btn.onclick = runBattleSequence;
        }
    }

    async function runBattleSequence() {
        battle_isPlaying = true;
        document.getElementById('actionBtn').disabled = true;
        let pSurvivors = []; let eSurvivors = [];

        for(let i=0; i<5; i++) {
            const eVal = battle_eDeck[i]; const pVal = battle_placedCards[i];
            const eWrap = document.getElementById(`eWrap${i}`);
            const eBack = document.getElementById(`eCard${i}`);
            eBack.textContent = eVal; eWrap.classList.add('flipped');
            playSfx('place');
            await new Promise(r => setTimeout(r, 600));

            const pSlot = document.querySelector(`.clash-slot[data-id="${i}"]`);
            const pCard = pSlot.querySelector('div');

            if (pVal > eVal) {
                eBack.classList.add('dead-content'); pCard.parentElement.classList.add('win-pulse'); pSurvivors.push({val: pVal});
            } else if (eVal > pVal) {
                pCard.classList.add('dead-content'); eBack.classList.add('win-pulse'); eSurvivors.push({val: eVal});
            } else {
                eBack.classList.add('dead-content'); pCard.classList.add('dead-content');
            }
            playSfx('click'); 
            await new Promise(r => setTimeout(r, 400));
        }

        await new Promise(r => setTimeout(r, 500));
        const pCount = pSurvivors.length; const eCount = eSurvivors.length;
        let dmgToEnemy = 0; let dmgToPlayer = 0;

        if (pCount > eCount) dmgToEnemy = pSurvivors.reduce((a, b) => a + b.val, 0);
        else if (eCount > pCount) dmgToPlayer = eSurvivors.reduce((a, b) => a + b.val, 0);
        else { dmgToEnemy = pSurvivors.reduce((a, b) => a + b.val, 0); dmgToPlayer = eSurvivors.reduce((a, b) => a + b.val, 0); }

        battle_eHP -= dmgToEnemy; if(dmgToEnemy > 0) flashDamage('e', dmgToEnemy);
        playerCurrentHP -= dmgToPlayer; if(dmgToPlayer > 0) flashDamage('p', dmgToPlayer); 
        if(playerCurrentHP < 0) playerCurrentHP = 0;

        updateBattleUI();
        await new Promise(r => setTimeout(r, 1500));
        checkBattleResult();
    }

    function flashDamage(who, amount) {
        if(amount <= 0) return;
        const txt = document.getElementById(who === 'e' ? 'eDmgText' : 'pDmgText');
        txt.textContent = "-" + amount; txt.classList.add('show');
        playSfx('hit');
        document.getElementById('battleArea').classList.add('shaking');
        if(who === 'e') document.querySelector('.boss-banner').classList.add('hit');
        setTimeout(() => {
            txt.classList.remove('show');
            document.getElementById('battleArea').classList.remove('shaking');
            document.querySelector('.boss-banner').classList.remove('hit');
        }, 800);
    }

    function updateBattleUI() {
        if(battle_eHP < 0) battle_eHP = 0;
        document.getElementById('enemyHpBar').style.width = (battle_eHP/battle_eMaxHP)*100 + "%";
        document.getElementById('enemyHpText').textContent = battle_eHP + "/" + battle_eMaxHP;
        document.getElementById('playerHpBar').style.width = (playerCurrentHP/playerMaxHP)*100 + "%";
        document.getElementById('playerHpText').textContent = playerCurrentHP + "/" + playerMaxHP;
    }

    // --- 7. CORE LOGIC (Reward & Punishment) ---
    function checkBattleResult() {
        const modal = document.getElementById('resultModal');
        const title = document.getElementById('resultTitle');
        const sub = document.getElementById('resultSub');
        const btn = document.getElementById('restartBtn');

        // CASE 1: SUDDEN DEATH
        if (battle_eHP <= 0 && playerCurrentHP <= 0) {
            title.textContent = "DOUBLE KO"; 
            title.style.color = "yellow";
            sub.innerHTML = "NO REWARD YET<br>ENTER SUDDEN DEATH MODE!";
            
            btn.textContent = "FIGHT FOR LIFE (10 HP)";
            btn.className = "main-btn sudden";
            btn.onclick = () => {
                battle_eHP = 10; battle_eMaxHP = 10;
                playerCurrentHP = 10; playerMaxHP = 10;
                // ‡πÑ‡∏°‡πà‡πÄ‡∏ã‡∏ü‡∏ï‡∏≠‡∏ô Sudden Death ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏õ‡∏Å‡∏ï‡∏¥
                updateBattleUI(); 
                initBattleState();
            };
            modal.style.display = 'flex';
            playSfx('win');

        // CASE 2: WIN
        } else if (battle_eHP <= 0) {
            const damageTaken = playerMaxHP - playerCurrentHP;
            let reward = battle_eMaxHP - damageTaken;
            if (reward <= 0) reward = 1; // ‡∏Å‡∏≤‡∏£‡∏±‡∏ô‡∏ï‡∏µ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 1

            playerCOIN += reward; 

            // EXP Logic
            let gainedEXP = expReward[currentMonsterType] || 1;
            playerEXP += gainedEXP;
            
            let levelUpText = "";
            if (levelConfig[playerLevel]) {
                const needed = levelConfig[playerLevel].need;
                if (playerEXP >= needed) {
                    playerEXP -= needed;
                    playerLevel++; 
                    // ‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì HP ‡∏ï‡∏≤‡∏°‡πÄ‡∏•‡πÄ‡∏ß‡∏• (‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡πä‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏î 12 ‡∏ñ‡∏≤‡∏ß‡∏£)
                    playerMaxHP = 20 + ((playerLevel - 1) * 2);
                    playerCurrentHP = playerMaxHP; // ‡πÄ‡∏ß‡∏•‡∏≠‡∏±‡∏û‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÄ‡∏ï‡πá‡∏°
                    
                    levelUpText = `<br><span style="color:#00ff00; font-weight:bold; font-size:1.2rem;">‚ú® LEVEL UP! (HP ${playerMaxHP})</span>`;
                    
                    if(!levelConfig[playerLevel]) {
                        levelUpText = `<br><span style="color:#ffd700; font-weight:bold; font-size:1.2rem;">üëë MAX LEVEL REACHED!</span>`;
                    }
                    playSfx('win');
                }
            }

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏™‡∏£‡πá‡∏à‡∏õ‡∏∏‡πä‡∏ö SAVE ‡∏õ‡∏±‡πä‡∏ö
            saveGame();

            updateLobbyStats();
            updateBalance();     

            title.textContent = "VICTORY"; 
            title.style.color = "#ff9d00";
            sub.innerHTML = `REWARD: <span style="color:#00eaff;">+${reward} COINS</span><br>EXP: <span style="color:#ffff00;">+${gainedEXP}</span> ${levelUpText}`;
            
            btn.textContent = "COLLECT & HUNT";
            btn.className = "main-btn";
            btn.onclick = () => {
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏à‡∏ö Sudden Death ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏ï‡∏≤‡∏° Level ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö Lobby
                playerMaxHP = 20 + ((playerLevel - 1) * 2); 
                playerCurrentHP = playerMaxHP; 
                saveGame(); // ‡πÄ‡∏ã‡∏ü‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå
                nav('map');
            };
            modal.style.display = 'flex';
            playSfx('win');

        // CASE 3: LOSE
        } else if (playerCurrentHP <= 0) {
            let penalty = 0;
            const halfMonsterHP = battle_eMaxHP / 2;
            
            if (battle_eHP >= halfMonsterHP) {
                penalty = playerMaxHP;
                sub.innerHTML = `ENEMY HEALTH HIGH (${battle_eHP})<br>LOST: <span style="color:red; font-size:1.5rem;">-${penalty} COINS</span>`;
            } else {
                penalty = Math.floor(playerMaxHP / 2);
                sub.innerHTML = `GOOD FIGHT! (ENEMY < 50%)<br>LOST: <span style="color:red; font-size:1.5rem;">-${penalty} COINS</span>`;
            }

            playerCOIN -= penalty;
            
            // ‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ MaxHP ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡πä‡∏Å Sudden Death)
            playerMaxHP = 20 + ((playerLevel - 1) * 2);

            saveGame(); // ‡πÅ‡∏û‡πâ‡∏Å‡πá‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ã‡∏ü

            updateBalance();

            title.textContent = "DEFEATED"; 
            title.style.color = "red";
            
            btn.textContent = "TRY AGAIN";
            btn.className = "main-btn";
            btn.onclick = () => {
                playerCurrentHP = playerMaxHP; 
                nav('map');
            }; 
            modal.style.display = 'flex';

        } else {
            // NEXT ROUND
            const btnAction = document.getElementById('actionBtn');
            btnAction.textContent = "NEXT ROUND"; 
            btnAction.disabled = false; 
            btnAction.classList.remove('attack');
            btnAction.onclick = initBattleState;
        }
    }

    // Start Game
    initMap();


    // Start
    initMap();
    </script>
</body>
</html>
